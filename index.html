<!DOCTYPE html>
<!-- Template by html.am -->
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>ProductVideos.TV -- Daily stream of novelty and innovation</title>
		<style type="text/css">
		
			body {
				margin:0;
				padding:0;
				font-family: Sans-Serif;
				line-height: 1.5em;
			}
			
			header {
				background: #ccc;
				height: 100px;
			}
			
			header h1 {
				margin: 0;
				padding-top: 15px;
			}
			
			main {
				padding-bottom: 10010px;
				margin-bottom: -10000px;
				float: left;
				width: 100%;
			}
			
			nav {
				padding-bottom: 10010px;
				margin-bottom: -10000px;
				float: left;
				width: 230px;
				margin-left: -230px;
				background: #eee;
			}
			
			footer {
				clear: left;
				width: 100%;
				background: #ccc;
				text-align: center;
				padding: 4px 0;
			}
	
			#wrapper {
				overflow: hidden;
			}
						
			#content {
				margin-right: 230px; /* Same as 'nav' width */
			}
			
			.innertube {
				margin: 15px; /* Padding for content */
				margin-top: 0;
			}
		
			p {
				color: #555;
			}
	
			nav ul {
				list-style-type: none;
				margin: 0;
				padding: 0;
			}
			
			nav ul a {
				color: darkgreen;
				text-decoration: none;
			}
		
		</style>
		
		<link href="css/tTable.css" type="text/css" rel="stylesheet"/>
		
		<script src="https://apis.google.com/js/client.js?onload=clientApiLoaded"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
		<script src="https://www.papaparse.com/resources/js/papaparse.js"></script>
		<script src="js/libs/jquery.min.js"></script>
		<script src="js/libs/lodash.min.js"></script>
		<script src="tTable.js"></script>
		<script type="text/javascript">
			/* =============================
			This script generates sample text for the body content. 
			You can remove this script and any reference to it. 
			 ============================= */
			var bodyText=["The smaller your reality, the more convinced you are that you know everything.", "If the facts don't fit the theory, change the facts.", "The past has no power over the present moment.", "This, too, will pass.", "</p><p>You will not be punished for your anger, you will be punished by your anger.", "Peace comes from within. Do not seek it without.", "<h3>Heading</h3><p>The most important moment of your life is now. The most important person in your life is the one you are with now, and the most important activity in your life is the one you are involved with now."]
			function generateText(sentenceCount){
				for (var i=0; i<sentenceCount; i++)
				document.write(bodyText[Math.floor(Math.random()*7)]+" ")
			}
		</script>	
	
	</head>
	
	<body>		

		<header>
			<div class="innertube">
				<h1>ProductVideos.TV</h1>
				<h2>Daily updated with new products from ProductHunt and all over the web.</h2>
			</div>
		</header>
		
		<div id="wrapper">
		
			<main>
				<div id="content">
					<div class="innertube">
						<!-- <h1>Heading</h1> -->
						<!-- <p><script>generateText(20)</script></p> -->
						<div class="videowrapper">
							<div id="myytplayer"></div>
						</div>
						<br/>
						<div id="table_id"></div>
						<div id="table_id_pager"></div>
						<div id="table_id_search"></div>


						<script type="text/javascript">
								
							var parsedResults;
							
							Papa.parse("https://productvideostv.github.io/website/ProductVideosPlaylist.csv", {
										download: true,
										delimiter: ';',
										header: true,
										complete: function(results) 
										{
												parsedResults = results;
												console.log(results);
												buildPlaylist(parsedResults.data);
										}
									});
									
							var tag = document.createElement('script');
							tag.src = "https://www.youtube.com/iframe_api";
							var firstScriptTag = document.getElementsByTagName('script')[0];
							firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
									
							
							function getYouTubeVideoIdFromUrl(url)
							{
								var videoId = url.match(				/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s&]+)/);
								return videoId[1];
							}
							
							var videoIndex = 0;
							function getVideoIdToPlayNext(parsedVideos)
							{
								if (videoIndex >= parsedVideos.length)
								{
									return null;
								}
								var videoId;
								while(videoIndex < parsedVideos.length)
								{
									var url = parsedVideos[videoIndex]["VideoURL"];
									console.log(url);
									videoId = getYouTubeVideoIdFromUrl(url);
									console.log(videoId);	
									if (localStorage.getItem(videoId) == null)
									{
										break;
									}
									videoIndex++;
								}
								if (videoIndex >= parsedVideos.length)
								{
									return null;
								}
								return videoId;
							}
							
							function storePlayedVideoId(videoId)
							{
								localStorage.setItem(videoId, videoId);
								videoIndex++;
							}
							
							var playlist;
							function buildPlaylist(parsedVideos)
							{
								playlist = new tTable( {
										titles : [
											{ "title": "Title", "type" : "string" },
											{ "title": "VideoURL", "type" : "string" },
											{ "title": "Description", "type" : "string" },
											{ "title": "TimeWhenAdded", "type" : "string" }
										],
										row_numbers : true,
//										data : parsedVideos,
										goto : false, 
										hover_cols : false, 
										nav_arrows : false, 
										sorting : false,
										search : true,
										search_auto : true,
										search_container : "#table_id_search",
										search_sensitive : true,
										search_value : "",
										container : "#table_id",
										pager : "#table_id_pager"
									} );
									
									for(var index = 0; index < parsedVideos.length; ++index)
									{
										var parsedVideo = parsedVideos[index];
										var row = [parsedVideo["Title"], parsedVideo["VideoURL"], 
													parsedVideo["Description"], parsedVideo["TimeWhenAdded"]];
										playlist.addRow(row);
									}
							}

							var ytplayer;
							var currentVideoId;
							function onYouTubeIframeAPIReady()
							{
								var videoId = getVideoIdToPlayNext(parsedResults.data);
								ytplayer = new YT.Player('myytplayer', {
													width: 640,
													height: 480,
													videoId: videoId,
													playerVars: {
													  iv_load_policy: 3  // hide annotations
													},
													events: {
														'onReady': onPlayerReady,
														'onStateChange': onytplayerStateChange
													}
												});
							}
							
							function onPlayerReady(event) 
							{
								event.target.playVideo();
							}
							
							
							function onytplayerStateChange(a)
							{
								if(a.data==YT.PlayerState.ENDED)
								{
									storePlayedVideoId(currentVideoId);
									var videoId = getVideoIdToPlayNext(parsedResults.data);
									if(videoId != null) 
									{
									   ytplayer.loadVideoById(videoId);
									} 
									else 
									{ 
										console.log("The youtube url is not valid.");
										ytplayer.stopVideo();
									}
								}
							}

							
						</script>
					</div>
				</div>
			</main>
			
			<nav>
				<div class="innertube">
					<!-- <h3>Right heading</h3>
					<ul>
						<li><a href="#">Link 1</a></li>
						<li><a href="#">Link 2</a></li>
						<li><a href="#">Link 3</a></li>
						<li><a href="#">Link 4</a></li>
						<li><a href="#">Link 5</a></li>
					</ul>
					<h3>Right heading</h3>
					<ul>
						<li><a href="#">Link 1</a></li>
						<li><a href="#">Link 2</a></li>
						<li><a href="#">Link 3</a></li>
						<li><a href="#">Link 4</a></li>
						<li><a href="#">Link 5</a></li>
					</ul>
					<h3>Right heading</h3>
					<ul>
						<li><a href="#">Link 1</a></li>
						<li><a href="#">Link 2</a></li>
						<li><a href="#">Link 3</a></li>
						<li><a href="#">Link 4</a></li>
						<li><a href="#">Link 5</a></li>
					</ul> -->
				</div>
			</nav>
		
		</div>
		
		<footer>
			<div class="innertube">
				<p>Footer...</p>
			</div>
		</footer>
	
	</body>
</html>
